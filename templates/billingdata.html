<!DOCTYPE html>
<html lang="en">

<head>
  <!-- meta -->
  <meta charset="UTF-8">
  <meta name="description" content="NO Description">
  <meta name="keywords" content="HTML, CSS, JavaScript">
  <meta name="author" content="Prompt">
  <meta name="copyright" content="Copyright © 2025">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Monthly Data</title>
  <!-- <link rel="stylesheet" href="style.css"> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/index.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Bootstrap Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">


<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">

<!-- DataTables JS -->
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/css/bootstrap-datepicker.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fontawesome-free/css/all.min.css') }}">
   <!-- Custom fonts for this template-->
   <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
   <link
       href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
       rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
 
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fontawesome-free/css/all.min.css') }}">
  
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/sb-admin-2.css') }}">
 

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper" >
  
        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar" >
  
            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/">
              <!-- <div class="sidebar-brand-icon rotate-n-15" >
                <img src="{{ url_for('static', filename='img/1200px-PTT-01.svg (1).png') }}" style="width: 40%;" alt="">
            </div> -->
                <div class="sidebar-brand-text mx-3" style="margin-top: 10px;">PTT<p style="font-size: xx-small;" >AUTOMATIC METER READING</p></div>
                
            </a>
  
            <!-- Divider -->
            <hr class="sidebar-divider my-0">
  
            <!-- Nav Item - Dashboard -->
            <!-- Nav Item - Dashboard -->
          <li class="nav-item active">
            <a class="nav-link" href="/">
              <i class="fas fa-fw fa-chart-area"></i>
                <span>Dashboard</span></a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading">
            Interface
        </div>

        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo"
                aria-expanded="true" aria-controls="collapseTwo">
                <i class="fas fa-fw fa-table"></i>
                <span>Reports</span>
            </a>
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <h6 class="collapse-header">List Reports:</h6>
                    <a class="collapse-item" href="billing_data">View Billing Data</a>
                    <a class="collapse-item" href="#">View EVC Status</a>
                    <a class="collapse-item" href="DailySummary">Daily Summary</a>
                    <a class="collapse-item" href="#">Monthly Summary</a>
                    <a class="collapse-item" href="site_detail">Site Detail</a>
                </div>
            </div>
        </li>
        <hr class="sidebar-divider">
        <div class="sidebar-heading">
          Manage
      </div>
        <!-- Nav Item - Utilities Collapse Menu -->
        <li class="nav-item">
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapsePages"
              aria-expanded="true" aria-controls="collapsePages">
              <i class="fas fa-user-cog"></i>


              <span>Manage Users</span>
          </a>
          <div id="collapsePages" class="collapse" aria-labelledby="headingPages" data-parent="#accordionSidebar">
              <div class="bg-white py-2 collapse-inner rounded">
                <h6 class="collapse-header">List Manage Users:</h6>
                <a class="collapse-item" href="add_user">Add User</a>
                <a class="collapse-item" href="edit_user">Edit User</a>
                <a class="collapse-item" href="remove_user">Remove User</a>
                <a class="collapse-item" href="user_history">User History</a>
              </div>
          </div>
      </li>
        
        <li class="nav-item">
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseUtilities"
              aria-expanded="true" aria-controls="collapseUtilities">
              <i class="fas fa-sitemap"></i>




              <span>Manage Sites</span>
          </a>
          <div id="collapseUtilities" class="collapse" aria-labelledby="headingUtilities"
              data-parent="#accordionSidebar">
              <div class="bg-white py-2 collapse-inner rounded">
                  <h6 class="collapse-header">List Manage Site:</h6>
                  <a class="collapse-item" href="add_site">Add Site</a>
                  <a class="collapse-item" href="edit_site">Edit Site</a>
                  <a class="collapse-item" href="remove_site">Remove Site</a>
                  
              </div>
          </div>
      </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading">
            Polling
        </div>

        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
          <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapsePolling"
              aria-expanded="true" aria-controls="collapsePolling">
              <i class="fas fa-cogs"></i>



              <span>Polling Setting</span>
          </a>
          <div id="collapsePolling" class="collapse" aria-labelledby="headingPolling"
              data-parent="#accordionSidebar">
              <div class="bg-white py-2 collapse-inner rounded">
                  <h6 class="collapse-header">List Polling Setting:</h6>
                  <a class="collapse-item" href="evc_management">EVC Management</a>
                  <a class="collapse-item" href="polling_route">Polling Range Setting</a>
                  <a class="collapse-item" href="polling_hourly">Polling Range Hourly</a>
                  <a class="collapse-item" href="mapping_config">Configuration Mapping</a>
                  <a class="collapse-item" href="mapping_billing">Daily Billing Mapping</a>
                  <a class="collapse-item" href="mapping_hourly">Hourly Billing Mapping</a>
                  
              </div>
          </div>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseActions"
            aria-expanded="true" aria-controls="collapseActions">
            <i class="fas fa-fw fa-wrench"></i>
            <span>Polling Actions</span>
        </a>
        <div id="collapseActions" class="collapse" aria-labelledby="headingActions"
            data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <h6 class="collapse-header">List Polling Actions:</h6>
                <a class="collapse-item" href="Manualpoll_data">Manual Poll (EVC Profile)</a>
                <a class="collapse-item" href="write_evc">Write Config (SG,CO2,N2)</a>
               
                
            </div>
        </div>
    </li>
           
      <hr class="sidebar-divider">
    <div class="sidebar-heading">
      Prediction
  </div>

  <!-- Nav Item - Pages Collapse Menu -->
  <li class="nav-item">
    <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseai"
        aria-expanded="true" aria-controls="collapseai">
        <i class="fas fa-robot"></i>
<span>AI Prediction</span>

    </a>
    <div id="collapseai" class="collapse" aria-labelledby="headingai"
        data-parent="#accordionSidebar">
        <div class="bg-white py-2 collapse-inner rounded">
            <h6 class="collapse-header">List AI Prediction:</h6>
            
            <a class="collapse-item" href="Numeric_Prediction">Numeric Prediction</a>
           
            
        </div>
    </div>
</li>    
          <!-- Nav Item - Tables -->
          
              <!-- Divider -->
              <hr class="sidebar-divider d-none d-md-block">
  
              <!-- Sidebar Toggler (Sidebar) -->
              <div class="text-center d-none d-md-inline">
                  <button class="rounded-circle border-0" id="sidebarToggle"></button>
              </div>
  
          </ul>
          <!-- End of Sidebar -->
<!-- Content Wrapper -->
<div id="content-wrapper" class="d-flex flex-column">

    <!-- Main Content -->
    <div id="content">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

            <!-- Sidebar Toggle (Topbar) -->
            <form class="form-inline">
                <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                    <i class="fa fa-bars"></i>
                </button>
            </form>

            <!-- Topbar Search -->
            <form
                      class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                      <div class="input-group">                    
                          <div class="input-group-append" style="padding: 0px 20px; display: inline-block; width: 40%;border-radius: 15px;margin-left: -40px;">
                            <img src="https://www.pttplc.com/uploads/About/logo_PTT_3.png" style="width: 100%;display: block;height: auto" alt="">
                          </div>
                      </div>
                  </form>

            <!-- Topbar Navbar -->
            <ul class="navbar-nav ml-auto">

                <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                <li class="nav-item dropdown no-arrow d-sm-none">
                    <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-search fa-fw"></i>
                    </a>
                    <!-- Dropdown - Messages -->
                    <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                        aria-labelledby="searchDropdown">
                        <form class="form-inline mr-auto w-100 navbar-search">
                            <div class="input-group">
                                <input type="text" class="form-control bg-light border-0 small"
                                    placeholder="Search for..." aria-label="Search"
                                    aria-describedby="basic-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="button">
                                        <i class="fas fa-search fa-sm"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </li>

 
                <div class="topbar-divider d-none d-sm-block"></div>

                <!-- Nav Item - User Information -->
                <li class="nav-item dropdown no-arrow">
                  <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <span class="mr-2 d-none d-lg-inline text-gray-600 small">{{username}}</span>
                  <i class="fa-solid fa-user fa-lg" style="color: #e5e9f6;"></i>
              </a>
                    <!-- Dropdown - User Information -->
                    <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                        aria-labelledby="userDropdown">
                        <a class="dropdown-item" href="#">
                            <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                            Profile
                        </a>
                        <a class="dropdown-item" href="#">
                            <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                            Settings
                        </a>
                        <a class="dropdown-item" href="#">
                            <i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
                            Activity Log
                        </a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="logout" >
                          <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                          Logout
                      </a>
                    </div>
                </li>

            </ul>

        </nav>
        <!-- End of Topbar -->

 <!-- <a href="/data_report_billing" id="generate_report_billing" class="btn btn-sm btn-primary shadow-sm" style="display: none;">
              <i class="fas fa-download fa-sm text-white-50"></i> Generate Report
          </a> -->

    <!-- sidebar-wrapper  -->
    <div class="container-fluid">
      <div class="d-sm-flex align-items-center justify-content-between mb-4">
          <h1 class="h3 mb-2 text-gray-800">View Billing Data</h1>
  
          <!-- Generate Report Billing Button -->
          <a href="#" id="generate_report_billing" class="btn btn-sm btn-primary shadow-sm" style="display: none;">
              <i class="fas fa-download fa-sm text-white-50"></i> Generate Report
          </a>
  
          <!-- Icons for Billing -->
          <div id="download_icons_billing" class="btn-group" style="display: none; ">
              <a href="/data_report_billing" id="generate_excel" class="btn btn-sm btn-success shadow-sm" title="Download Excel">
                  <i class="fas fa-file-excel"></i>
              </a>
              <a href="/data_report_billing_pdf" id="generate_pdf" class="btn btn-sm btn-danger shadow-sm" title="Download PDF">
                  <i class="fas fa-file-pdf"></i>
              </a>
          </div>
  
          <!-- Generate Report Config Button -->
          <a href="#" id="generate_report_config" class="btn btn-sm btn-primary shadow-sm" style="display: none;">
            <i class="fas fa-download fa-sm text-white-50"></i> Generate Report
        </a>
  
          <!-- Icons for Config -->
          <div id="download_icons_config" class="btn-group" style="display: none;">
              <a href="/data_report_config" id="generate_excel" class="btn btn-sm btn-success shadow-sm" title="Download Excel">
                  <i class="fas fa-file-excel"></i>
              </a>
              <a href="/data_report_config_pdf" id="generate_pdf" class="btn btn-sm btn-danger shadow-sm" title="Download PDF">
                  <i class="fas fa-file-pdf"></i>
              </a>
          </div>
  
          <!-- Generate Report Hourly Button -->
          <a href="#" id="generate_report_hourly" class="btn btn-sm btn-primary shadow-sm" style="display: none;">
              <i class="fas fa-download fa-sm text-white-50"></i> Generate Report
          </a>
  
          <!-- Icons for Hourly -->
          <div id="download_icons_hourly" class="btn-group" style="display: none;">
              <a href="/data_report_hourly" id="generate_excel" class="btn btn-sm btn-success shadow-sm" title="Download Excel">
                  <i class="fas fa-file-excel"></i>
              </a>
              <a href="/data_report_hourly_pdf" id="generate_pdf" class="btn btn-sm btn-danger shadow-sm" title="Download PDF">
                  <i class="fas fa-file-pdf"></i>
              </a>
          </div>
      </div>
  
     
        <div class="row-b ">
          <div class="col-md-12">
            <div class="form-group">
              <div class="box_we">
                <form method="get" action="#">
                  <div class="container-menu">
                    <div class="row-b ">

                      <div class="col-md-4-b" >
                        <label for="region_dropdown">Select Region:</label>
                        <select id="region_dropdown" name="region_dropdown" class="form-control">
                          <option value="{{ selected_region }}" selected>--selected_region--</option>
                          {% for region in region_options %}
                          <option value="{{ region }}" {% if selected_region==region %}selected{% endif %}>{{ region }}
                          </option>
                          {% endfor %}
                        </select>
                      </div>

                      <div class="col-md-4-b" >
                        <label for="tag_dropdown">Select Site:</label>
                        <select id="tag_dropdown" name="tag_dropdown" class="form-control">
                          <option value="{{ selected_tag }}" selected>--selected_tag--</option>
                          {% for tag in tag_options %}
                          <option value="{{ tag }}" {% if selected_tag==tag %}selected{% endif %}>{{ tag }}</option>
                          {% endfor %}
                        </select>
                      </div>
                      <div class="col-md-4-b">
                        <label for="type_dropdown">Select Type:</label>
                        <select id="type_dropdown" name="type_dropdown" class="form-control" onchange="showButtonsBasedOnSelection()">
                            <option value="" selected>--selected_type--</option>
                            <option value="Daily">Daily</option>
                            <option value="Hourly">Hourly</option>
                        </select>
                    </div>

                    <div id="picker_daily" class="col-md-4-b" style="display: none;">
                      <label for="date_picker_daily">Select Date:</label>
                      <input type="text" id="date_picker_daily" name="date_dropdown_daily" value="{{ selected_date }}" class="form-control" autocomplete="off" placeholder="--selected_date--" onchange="checkDate()" required>
                  </div>
                  

                    </div>
                    <hr class="sidebar-divider d-none d-md-block">

                    <div class="button-container d-flex justify-content-center" style="margin-top: 20px;">
                      <button id="daily_data_button" class="btn btn-success btn-icon-split mx-2" type="submit" name="query_type" value="daily_data" onclick="handleDailyDataButtonClick();" style="display: none;">
                        <span class="text">Daily Data</span>
                    </button>
                    
                    <button id="config_data_button" class="btn btn-primary btn-icon-split mx-2" type="submit" name="query_type" value="config_data" onclick="handleConfigDataButtonClick();" style="display: none;">
                        <span class="text">Config Data</span>
                    </button>
                    
                    <button id="hourly_data_button" class="btn btn-warning btn-icon-split mx-2" type="submit" name="query_type" value="hourly_data" onclick="handleHourlyDataButtonClick();" style="display: none;">
                        <span class="text">Hourly Data</span>
                    </button>
                      <button id="clear_button" class="btn btn-danger btn-icon-split mx-2" type="button" onclick="clearFilters()" style="display: none;">
                          <span class="text">Clear</span>
                      </button>
                  </div>

                  </div>
                  </div>
                </form>
              </div>
            </div>
          </div>

          {% if tables.get('daily_data_run1') %}
          <div class="box_we" >
            <div class="selected"style="display: flex; margin:0 20px;">
             
              <p>Region: <span id="selected_region">{{ selected_region }}</span></p>
              <p>/ Site: <span id="selected_tag">{{ selected_tag }}</span></p>
              <p>/ Date: <span id="selected_date">{{ selected_date }}</span></p>
              
            </div>
          </div>
          
          <div class="card shadow mb-4" style="margin:0 5px;">
              <div class="card-header py-3">
                  <h5>Run A: {{ selected_tag }}</h5>
                  <h6>EVC TYPE: {{ vc_name_dict['vc_name_list1'] }}</h6>
              </div>
              <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                  <div class="table-responsive">
                      <table class="table table-bordered data_daily" id="dataTableRun1" width="100%" cellspacing="0">
                          {{ tables['daily_data_run1']|safe }}
                      </table>
                  </div>
              </div>
          </div>
          {% endif %}
          
          {% if tables.get('daily_data_run2') %}
          <div class="card shadow mb-4" style="margin:0 5px;">
              <div class="card-header py-3">
                  <h5>Run B: {{ selected_tag }}</h5>
                  <h6>EVC TYPE: {{ vc_name_dict['vc_name_list2'] }}</h6>
              </div>
              <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                  <div class="table-responsive">
                      <table class="table table-bordered data_daily" id="dataTableRun2" width="100%" cellspacing="0">
                          {{ tables['daily_data_run2']|safe }}
                      </table>
                  </div>
              </div>
          </div>
          {% endif %}

            {% if tables.get('daily_data_run3') %}
            <div class="card shadow mb-4" style="margin:0 5px;">
                <div class="card-header py-3">
                    <h5>Run C: {{ selected_tag }}</h5>
                    <h6>EVC TYPE: {{ vc_name_dict['vc_name_list3'] }}</h6>
            </div>
              
            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                <div class="table-responsive" >
                  <table class="table table-bordered data_daily" id="dataTableRun3" width="100%" cellspacing="0">
                {{ tables['daily_data_run3']|safe }}
            </table>
        </div>
    </div>
</div>
            {% endif %}

            {% if tables.get('daily_data_run4') %}
            <div class="card shadow mb-4" style="margin:0 5px;">
                <div class="card-header py-3">
                    <h5>Run D: {{ selected_tag }}</h5>
                    <h6>EVC TYPE: {{ vc_name_dict['vc_name_list4'] }}</h6>
                   
            </div>
              
            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                <div class="table-responsive" >
                  <table class="table table-bordered data_daily" id="dataTableRun4" width="100%" cellspacing="0">
                {{ tables['daily_data_run4']|safe }}
            </table>
        </div>
    </div>
</div>
            {% endif %}

            {% if tables.get('daily_data_run5') %}
            <div class="card shadow mb-4" style="margin:0 5px;">
                <div class="card-header py-3">
                    <h5>Run E: {{ selected_tag }}</h5>
                    <h6>EVC TYPE: {{ vc_name_dict['vc_name_list5'] }}</h6>
                 
            </div>
              
            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                <div class="table-responsive" >
                  <table class="table table-bordered data_daily" id="dataTableRun5" width="100%" cellspacing="0">
                {{ tables['daily_data_run5']|safe }}
            </table>
        </div>
    </div>
</div>
            {% endif %}
            {% if tables.get('daily_data_run6') %}
            <div class="card shadow mb-4" style="margin:0 5px;">
                <div class="card-header py-3">
                    <h5>Run F: {{ selected_tag }}</h5>
                    <h6>EVC TYPE: {{ vc_name_dict['vc_name_list6'] }}</h6>
                    
            </div>
              
            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                <div class="table-responsive" >
                  <table class="table table-bordered data_daily" id="dataTableRun6" width="100%" cellspacing="0">
                {{ tables['daily_data_run6']|safe }}
          
            </table>
        </div>
    </div>
</div>
            {% endif %}
            
            {% if tables.get('combined_totals') %}
<div class="card shadow mb-4" style="margin:0 5px;">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Combined Totals</h6> <!-- เพิ่มชื่อหรือหัวข้อที่เหมาะสม -->
    </div>
    
    <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
        <div class="table-responsive">
            {{ tables["combined_totals"]|safe }} <!-- ตาราง combined_totals จะถูกแสดงที่นี่ -->
        </div>
    </div>
</div>
<div class="button-container d-flex flex-column align-items-center" style="margin-top: 20px;">
  <button class="btn btn-warning btn-icon-split mx-2" type="button" onclick="toggleContent()">
      <span class="text">Show Graphs</span>
  </button>
  
  <!-- Spinner positioned below the button -->
  <div id="loading-spinner" style="display: none; margin-top: 10px; text-align: center;">
      <div class="spinner-border text-warning" role="status">
          <span class="visually-hidden"></span>
      </div>
  </div>
</div>

{% endif %}
          </div>
         
        <br>
        <div class="container-fluid_graphs">
       
        </div>
          <div class="row">
              <div class="col-md-6 col-xs-12">
                  {% if graphs_corrected %}
                      <div>{{ graphs_corrected | safe }}</div>
                  {% endif %}
              </div>
              <div class="col-md-6 col-xs-12">
                  {% if graphs_uncorrected %}
                      <div>{{ graphs_uncorrected | safe }}</div>
                  {% endif %}
              </div>
          </div>
      
        

          {% if tables.get('hourly_data_run1') %}
          <div class="box_we" >
            <div class="selected"style="display: flex; margin:0 20px;">
             
              <p>Region: <span id="selected_region">{{ selected_region }}</span></p>
              <p>/ Site: <span id="selected_tag">{{ selected_tag }}</span></p>
              <p>/ Date: <span id="selected_date">{{ selected_date }}</span></p>
              
            </div>
          </div>
          

          <div class="card shadow mb-4" style="margin:0 20px;">
            <div class="card-header py-3">
             
                <h5>Run A: {{ selected_tag }}</h5>
                <h6>EVC TYPE: {{ vc_name_dict['vc_name_list1'] }}</h6>
                
            </div>
            
            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
            <div class="table-responsive" >
                <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0">
                {{ tables['hourly_data_run1']|safe }}
              </table>
            </div>
        </div>
    </div>
            {% endif %}
              
              

            {% if tables.get('hourly_data_run2') %}
            <div class="card shadow mb-4" style="margin:0 20px;">
                <div class="card-header py-3">
              <h5>Run B: {{ selected_tag }}</h5>
              <h6>EVC TYPE: {{ vc_name_dict['vc_name_list2'] }}</h6>
            </div>

              <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
            <div class="table-responsive" >
                <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0">
                {{ tables['hourly_data_run2']|safe }}
            </table>
        </div>
    </div>
</div>
            {% endif %}

            {% if tables.get('hourly_data_run3') %}
            <div class="card shadow mb-4" style="margin:0 20px;">
                <div class="card-header py-3">
                    <h5>Run C: {{ selected_tag }}</h5>
                    <h6>EVC TYPE: {{ vc_name_dict['vc_name_list3'] }}</h6>
            </div>
              
            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                <div class="table-responsive" >
                    <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0">
                {{ tables['hourly_data_run3']|safe }}
            </table>
        </div>
    </div>
</div>
            {% endif %}

            {% if tables.get('hourly_data_run4') %}
            <div class="card shadow mb-4" style="margin:0 20px;">
                <div class="card-header py-3">
                    <h5>Run D: {{ selected_tag }}</h5>
                    <h6>EVC TYPE: {{ vc_name_dict['vc_name_list4'] }}</h6>
            </div>
              
            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                <div class="table-responsive" >
                    <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0">
                {{ tables['hourly_data_run4']|safe }}
            </table>
        </div>
    </div>
</div>
            {% endif %}
            {% if tables.get('hourly_data_run5') %}
            <div class="card shadow mb-4" style="margin:0 20px;">
                <div class="card-header py-3">
                    <h5>Run D: {{ selected_tag }}</h5>
                    <h6>EVC TYPE: {{ vc_name_dict['vc_name_list5'] }}</h6>
            </div>
              
            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                <div class="table-responsive" >
                    <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0">
                {{ tables['hourly_data_run5']|safe }}
            </table>
        </div>
    </div>
</div>
            {% endif %}

            {% if tables.get('hourly_data_run6') %}
            <div class="card shadow mb-4" style="margin:0 20px;">
                <div class="card-header py-3">
                    <h5>Run D: {{ selected_tag }}</h5>
                    <h6>EVC TYPE: {{ vc_name_dict['vc_name_list6'] }}</h6>
            </div>
              
            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                <div class="table-responsive" >
                    <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0">
                {{ tables['hourly_data_run6']|safe }}
            </table>
        </div>
    </div>
</div>
            {% endif %}
          </div>



          {% if tables.get('config_data_run1') %}
          <div class="box_we" >
            <div class="selected"style="display: flex; margin:0 20px;">
             
              <p>Region: <span id="selected_region">{{ selected_region }}</span></p>
              <p>/ Site: <span id="selected_tag">{{ selected_tag }}</span></p>
              <p>/ Date: <span id="selected_date">{{ selected_date }}</span></p>
              
            </div>
          </div>
          <div class="card shadow mb-4" style="margin: 0 20px;">
            <div class="card-header py-3">
               
                <h5>Run A: {{ selected_tag }}</h5>
                <h6>EVC TYPE: {{ vc_name_dict['vc_name_list1'] }}</h6>

            </div>
                      
            <div class="card-body d-flex justify-content-center align-items-center" style="width: 100%;">
              <div class="table-responsive" style="font-size: xx-small; width: 100%;">
                  <table class="table table-bordered" id="dataTable" cellspacing="0" style="width: 100%;  border-collapse: collapse;">
                      {{ html_table1 | safe }}
                  </table>
              </div>
          </div>
      </div>
                {% endif %}
                <br><br>

                {% if tables.get('config_data_run2') %}
                <div class="card shadow mb-4" style="margin: 0 20px;">
                    <div class="card-header py-3">
                        
                        <h5>Run B: {{ selected_tag }}</h5>
                        <h6>EVC TYPE: {{ vc_name_dict['vc_name_list2'] }}</h6>
                </div>
                        
                <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                    <div class="table-responsive" style="font-size:xx-small;">
                        <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0" style="font-size:xx-small;">
                          <!-- The following line combines thead and tbody into a single block -->
                        
                          <tbody>
                            {{ html_table2 | safe }}
                          </tbody>
                        </table>
                    </div>
                </div>
            </div>
        
                      {% endif %}
                      <br><br>


                      {% if tables.get('config_data_run3') %}
                      <div class="card shadow mb-4" style="margin: 0 20px;">
                    <div class="card-header py-3" >
                       
                        <h5>Run C: {{ selected_tag }}</h5>
                        <h6>EVC TYPE: {{ vc_name_dict['vc_name_list3'] }}</h6>
                </div>
                <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                    <div class="table-responsive" style="font-size:xx-small;">
                        <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0" style="font-size:xx-small;">
                                <!-- The following line combines thead and tbody into a single block -->
                             
                                <tbody>
                                  {{ html_table3 | safe }}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
         
                            {% endif %}
                            <br><br>


                            {% if tables.get('config_data_run4') %}
                            <div class="card shadow mb-4" style="margin: 0 20px;">
                    <div class="card-header py-3">
                       
                        <h5>Run D: {{ selected_tag }}</h5>
                        <h6>EVC TYPE: {{ vc_name_dict['vc_name_list4'] }}</h6>
                </div>
                <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                    <div class="table-responsive" style="font-size:xx-small;">
                        <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0" style="font-size:xx-small;">
                                      <!-- The following line combines thead and tbody into a single block -->
                                   
                                      <tbody>
                                        {{ html_table4 | safe }}
                                      </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                                  {% endif %}
                                  <br><br>


                                  {% if tables.get('config_data_run5') %}
                                    <div class="card shadow mb-4" style="margin: 0 20px;">
                    <div class="card-header py-3">
                        
                        <h5>Run E: {{ selected_tag }}</h5>
                        <h6>EVC TYPE: {{ vc_name_dict['vc_name_list5'] }}</h6>
                </div>
                <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                    <div class="table-responsive" style="font-size:xx-small;">
                        <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0" style="font-size:xx-small;">
                                            <!-- The following line combines thead and tbody into a single block -->
                                          
                                            <tbody>
                                              {{ html_table5 | safe }}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                                        {% endif %}
                                        <br><br>



                            
                            {% if tables.get('config_data_run6') %}
                            <div class="card shadow mb-4" style="margin: 0 20px;">
                                <div class="card-header py-3">
                                   
                                    <h5>Run F: {{ selected_tag }}</h5>
                                    <h6>EVC TYPE: {{ vc_name_dict['vc_name_list6'] }}</h6>
                            </div>
                            <div class="card-body d-flex justify-content-center align-items-center" style="height: 100%;">
                                <div class="table-responsive" style="font-size:xx-small;">
                                    <table class="table table-bordered" id="dataTable" width="100%"  cellspacing="0" style="font-size:xx-small;">
                                      <!-- The following line combines thead and tbody into a single block -->
                                      
                                      <tbody>
                                        {{ html_table6 | safe }}
                                      </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                                  {% endif %}
                                </div>
                              </div>
                              <!-- <div class="form-group col-md-12"> -->
                            </div>
                          </div>
                        </div>
                      </div>

    <!-- page-content" -->


  </div>
  <div id="popup-overlay" class="popup-overlay" onclick="closePopup()"></div>
  <div id="popup" class="popup">
      <p id="popup-message">Loading...</p>
      <button onclick="closePopup()">Close</button>
      
  </div>

  <script>
    function toggleContent() {
     // Show the loading spinner
     $('#loading-spinner').show();
 
     $.ajax({
         url: "/billing_show_graph",
         type: "GET",
         success: function(data) {
             // Clear existing graphs
             $('.container-fluid_graphs').empty();
 
             // Hide the spinner once data is loaded
             $('#loading-spinner').hide();
 
             // Helper function to append graphs
             function appendGraphs(graphHtml, containerClass) {
                 if (graphHtml) {
                   $('.container-fluid_graphs').append(`<div class="${containerClass}">${graphHtml}</div>`);
                 }
             }
 
             // Append corrected and uncorrected graphs
             appendGraphs(data.graphs_corrected, 'col-md-6 col-xs-12');
             appendGraphs(data.graphs_uncorrected, 'col-md-6 col-xs-12');
           
         },
         error: function(error) {
             // Hide the spinner in case of an error
             $('#loading-spinner').hide();
 
             console.error("Error fetching graphs:", error);
         }
     });
 }
 </script>
 

<script>
  document.addEventListener('DOMContentLoaded', function() {
      var currentUrl = window.location.href;

      // Load visibility states from sessionStorage on page load
      var billingVisible = sessionStorage.getItem('generateReportBillingVisible') === 'true';
      var configVisible = sessionStorage.getItem('generateReportConfigVisible') === 'true';
      var hourlyVisible = sessionStorage.getItem('generateReportHourlyVisible') === 'true';

      // Handle displaying links based on the URL
      function updateLinkVisibility() {
          var reportBillingLink = document.getElementById('generate_report_billing');
          var reportConfigLink = document.getElementById('generate_report_config');
          var reportHourlyLink = document.getElementById('generate_report_hourly');

          if (currentUrl.includes('query_type=daily_data')) {
              reportBillingLink.style.display = billingVisible ? 'inline-block' : 'none';
              reportConfigLink.style.display = 'none';
              reportHourlyLink.style.display = 'none';
          } else if (currentUrl.includes('query_type=config_data')) {
              reportConfigLink.style.display = configVisible ? 'inline-block' : 'none';
              reportBillingLink.style.display = 'none';
              reportHourlyLink.style.display = 'none';
          } else if (currentUrl.includes('query_type=hourly_data')) {
              reportHourlyLink.style.display = hourlyVisible ? 'inline-block' : 'none';
              reportConfigLink.style.display = 'none';
              reportBillingLink.style.display = 'none';
          } else {
              reportBillingLink.style.display = 'none';
              reportConfigLink.style.display = 'none';
              reportHourlyLink.style.display = 'none';
          }
      }

      // Execute link visibility update on window load
      window.addEventListener('load', updateLinkVisibility);
  });

  function handleDailyDataButtonClick() {
      // Set the visibility state in sessionStorage
      sessionStorage.setItem('generateReportBillingVisible', 'true');
      sessionStorage.setItem('generateReportConfigVisible', 'false');
      sessionStorage.setItem('generateReportHourlyVisible', 'false');

      // Reload the page
      location.reload();
  }

  function handleConfigDataButtonClick() {
      sessionStorage.setItem('generateReportConfigVisible', 'true');
      sessionStorage.setItem('generateReportBillingVisible', 'false');
      sessionStorage.setItem('generateReportHourlyVisible', 'false');

      // Reload the page
      location.reload();
  }

  function handleHourlyDataButtonClick() {
      sessionStorage.setItem('generateReportHourlyVisible', 'true');
      sessionStorage.setItem('generateReportBillingVisible', 'false');
      sessionStorage.setItem('generateReportConfigVisible', 'false');

      // Reload the page
      location.reload();
  }

  function validateDateMode(mode) {
      // Your existing validation logic here
      console.log("Validation for mode:", mode);
      return true; // Or false depending on your validation logic
  }
</script>


<script>
  $(document).ready(function() {
    // Initialize DataTable for all tables with class 'data_daily'
    $('table.data_daily').each(function() {
        var $table = $(this);
        var $totalRow = $table.find('tbody tr:last-child').detach(); // Store the Total row specific to this table
        
        // Initialize DataTable for this specific table
        $table.DataTable({
            "paging": true,
            "searching": true,
            "ordering": false,
            "info": true,
            "scrollX": false,
            "autoWidth": true,
            "responsive": true,
            "order": [[0, 'asc']],
            "pageLength": 31,
            "columnDefs": [
                //{ "orderable": true, "targets": 0 },
                { "orderable": false, "targets": "_all" }
            ],
            "drawCallback": function(settings) {
                // Append the Total row back to the specific table body at the end
                $table.find('tbody').append($totalRow);
            }
        });
    });


      // Initialize DataTable for table with class 'data_config'
      $('table.data_config').DataTable({
          "paging": true,
          "searching": true,
          "ordering": false,
          "info": true,
          "order": [[0, 'asc']], // Order by first column (descending)
          "pageLength": 31,
          "columnDefs": [
            //  { "orderable": true, "targets": 1 }, // Enable sorting for the first column
              { "orderable": false, "targets": "_all" } // Disable sorting for all other columns
          ]
      });

      jQuery.fn.dataTable.ext.type.order['custom-date-hour-pre'] = function(data) {
        let parts = data.split(' or ');
        if (parts.length !== 2) return 0; // Handle unexpected format
    
        let dateStr = parts[0];
        let hour = parseInt(parts[1], 10);
        
        // Handle NaN case
        if (isNaN(hour)) hour = 0;
    
        let dateParts = dateStr.split('-');
        let day = parseInt(dateParts[0], 10);
        let month = new Date(Date.parse(dateParts[1] + " 1, 2024")).getMonth();
        let year = parseInt("20" + dateParts[2], 10);
    
        let sortableValue = new Date(year, month, day).getTime() + (hour / 24);
    
        console.log(`Sortable value for ${data}: ${sortableValue}`);
        
        return sortableValue;
    };
    
    // DataTable initialization
    $('table.data_hourly').DataTable({
        "paging": true,
        "searching": true,
        "ordering": false,
        "info": true,
        "scrollX": false,
        "autoWidth": true,
        "responsive": true,
        "order": [[0, 'desc']], // Default order by first column
        "columnDefs": [
            { "type": "custom-date-hour", "targets": 0 }, // Apply custom sorting to the first column
            { "orderable": false, "targets": [1, 2, 3,4] } // Disable sorting for other columns
        ]
    });
   
  });
</script>

     <script>
      document.addEventListener('DOMContentLoaded', function () {
          let isMonthMode = true; // เริ่มต้นในโหมดเลือกเดือน
          const selectedDate = "{{ selected_date }}"; // เก็บค่าจาก {{ selected_date }}
          
          // ตรวจสอบรูปแบบของ selectedDate
          const isDateRange = /^\d{2}\/\d{2}\/\d{4}\s*to\s*\d{2}\/\d{2}\/\d{4}$/.test(selectedDate); // ตรวจสอบว่าเป็นช่วงวันที่
          const isSingleDate = /^\d{2}\/\d{2}\/\d{4}$/.test(selectedDate); // ตรวจสอบว่าเป็นวันที่เดียว
          const isSingleMonth = /^\d{2}\/\d{4}$/.test(selectedDate); // ตรวจสอบว่าเป็นเดือนเดียว
  
          if (isSingleDate || isDateRange) {
              isMonthMode = false; // ถ้าเป็นวันที่หรือช่วงวันที่ ให้ใช้โหมดวันที่
          } else if (isSingleMonth) {
              isMonthMode = true; // ถ้าเป็นเดือน ให้ใช้โหมดเดือน
          }
  
          function initFlatpickr() {
              flatpickr("#date_picker_daily", {
                  mode: isMonthMode ? "single" : "range",
                  dateFormat: isMonthMode ? "m/Y" : "d/m/Y",
                  defaultDate: isMonthMode ? (isSingleMonth ? selectedDate : new Date()) : (isSingleDate || isDateRange ? selectedDate : new Date()), // ใช้ selected_date หรือวันที่ปัจจุบันเมื่อเริ่มต้น
                  plugins: isMonthMode ? [
                      new monthSelectPlugin({
                          shorthand: true,
                          dateFormat: "m/Y",
                          altFormat: "F Y",
                          theme: "light"
                      })
                  ] : [],
                  onChange: function(selectedDates, dateStr, instance) {
                      if (!isMonthMode) {
                          currentDate = selectedDates[0] || new Date(); // อัพเดทวันที่ที่เลือก หรือวันที่ปัจจุบัน
                      }
                  },
                  onReady: function(selectedDates, dateStr, instance) {
                      const calendarContainer = instance.calendarContainer;
                      if (calendarContainer) {
                          const existingButton = calendarContainer.querySelector('.toggle-mode-button');
                          if (existingButton) {
                              existingButton.remove();
                          }
                          const toggleButton = document.createElement('button');
                          toggleButton.type = 'button';
                          toggleButton.className = 'toggle-mode-button';
                          toggleButton.textContent = isMonthMode ? 'Select Date Range' : 'Select Month';
                          toggleButton.style.margin = '10px';
                          toggleButton.style.padding = '5px 10px';
                          toggleButton.style.border = 'none';
                          toggleButton.style.backgroundColor = '#007bff';
                          toggleButton.style.color = '#fff';
                          toggleButton.style.cursor = 'pointer';
                          toggleButton.addEventListener('click', function() {
                              isMonthMode = !isMonthMode; // สลับโหมด
                              instance.destroy(); // ทำลาย instance เดิม
                              setTimeout(initFlatpickr, 0); // เริ่มต้นใหม่ด้วยโหมดใหม่
                          });
                          calendarContainer.appendChild(toggleButton);
                      }
                  }
              });
          }
  
          // เริ่มต้น Flatpickr เมื่อโหลดหน้า
          initFlatpickr();
      });
  </script>


  <script>
 

// Add click event listener to "Generate Report Billing" button
document.getElementById('generate_report_billing').addEventListener('click', function() {
  var reportBillingButton = document.getElementById('generate_report_billing');
  var downloadIconsBilling = document.getElementById('download_icons_billing');

  // Animate the generate_report_billing button
  reportBillingButton.style.transform = 'translateY(-50%)';
  reportBillingButton.style.opacity = '0';

  // Show the download icons for billing
  setTimeout(function() {
      downloadIconsBilling.style.display = 'inline-flex';
      setTimeout(function() {
          downloadIconsBilling.style.opacity = '1';
          downloadIconsBilling.style.transform = 'translateY(0)';
      }, 10);
  }, 500);
});

// Add click event listener to "Generate Report Config" button
document.getElementById('generate_report_config').addEventListener('click', function() {
  var reportConfigButton = document.getElementById('generate_report_config');
  var downloadIconsConfig = document.getElementById('download_icons_config');

  // Animate the generate_report_config button
  reportConfigButton.style.transform = 'translateY(-50%)';
  reportConfigButton.style.opacity = '0';

  // Show the download icons for config
  setTimeout(function() {
      downloadIconsConfig.style.display = 'inline-flex';
      setTimeout(function() {
          downloadIconsConfig.style.opacity = '1';
          downloadIconsConfig.style.transform = 'translateY(0)';
      }, 10);
  }, 500);
});

// Add click event listener to "Generate Report Hourly" button
document.getElementById('generate_report_hourly').addEventListener('click', function() {
  var reportHourlyButton = document.getElementById('generate_report_hourly');
  var downloadIconsHourly = document.getElementById('download_icons_hourly');

  // Animate the generate_report_hourly button
  reportHourlyButton.style.transform = 'translateY(-50%)';
  reportHourlyButton.style.opacity = '0';

  // Show the download icons for hourly
  setTimeout(function() {
      downloadIconsHourly.style.display = 'inline-flex';
      setTimeout(function() {
          downloadIconsHourly.style.opacity = '1';
          downloadIconsHourly.style.transform = 'translateY(0)';
      }, 10);
  }, 500);
});

    
  
  </script>

<script>
  function showButtonsBasedOnSelection() {
      var selectedType = document.getElementById("type_dropdown").value;

      // Save the selected type to localStorage
      localStorage.setItem('selectedType', selectedType);

      // Hide all buttons initially
      document.getElementById("daily_data_button").style.display = "none";
      document.getElementById("config_data_button").style.display = "none";
      document.getElementById("hourly_data_button").style.display = "none";
      document.getElementById("clear_button").style.display = "none";
      document.getElementById("picker_daily").style.display = "none";

      // Update mode and date based on the selected type
      if (selectedType === "Daily") {
          isMonthMode = true;
          currentDate = new Date(new Date().getFullYear(), new Date().getMonth(), 1); // Set to the start of the current month
          document.getElementById("daily_data_button").style.display = "block";
          document.getElementById("config_data_button").style.display = "block";
          document.getElementById("clear_button").style.display = "block";
          document.getElementById("picker_daily").style.display = "block";
          
      } else if (selectedType === "Hourly") {
          isMonthMode = false;
          currentDate = new Date(); // Set to the current date
          document.getElementById("hourly_data_button").style.display = "block";
          document.getElementById("clear_button").style.display = "block";
          document.getElementById("picker_daily").style.display = "block";
      }

      // Reinitialize Flatpickr with the updated mode and date
      initFlatpickr();
  }

  window.onload = function() {
      // Check if it's the first visit by checking the URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const isFirstVisit = !urlParams.has('type_dropdown') && !urlParams.has('date_dropdown_daily');
      
      if (isFirstVisit) {
          // Reset the page state to default
          localStorage.removeItem('selectedType'); // Clear any stored type
          document.getElementById("type_dropdown").value = ""; // Or set to a default value if needed
          showButtonsBasedOnSelection(); // Call function to handle the default state
      } else {
          // Check if there's a previously selected type in localStorage
          var savedType = localStorage.getItem('selectedType');
          if (savedType) {
              document.getElementById("type_dropdown").value = savedType;
          }
          showButtonsBasedOnSelection();
      }
  };
</script>


<script>
  function validateDateMode(queryType) {
      // Get the selected radio button value
      const selectedDateMode = document.querySelector('input[name="date_mode"]:checked');
      
      // Check if the "Date" radio button is selected
      if (selectedDateMode && selectedDateMode.value === 'date') {
          alert(`Please change to "Month" mode before submitting for ${queryType}.`);
          return false; // Prevent form submission
      }
      
      return true; // Allow form submission
  }
  </script>

<script>
  function sendDataDate(data_date, run_number) {
    const selectedRegion = document.getElementById('selected_region').textContent;
    const selectedTag = document.getElementById('selected_tag').textContent;

    fetch('/billing_data_error', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            data_date: data_date,
            selected_region: selectedRegion,
            selected_tag: selectedTag,
            run_number: run_number
        })
    })
    .then(response => response.json())
    .then(data => {
        const popupMessage = document.getElementById('popup-message');
        popupMessage.innerHTML = ''; // Clear previous content if any

        if (data.data.length === 0) {
            // Display message if no data is available
            const noDataMessage = document.createElement('p');
            noDataMessage.textContent = 'No data available';
            popupMessage.appendChild(noDataMessage);
        } else {
            // Create a container for horizontal layout
            const horizontalContainer = document.createElement('div');
            horizontalContainer.classList.add('horizontal-container'); // Add a class for styling

            // Loop through each item in data.data
            data.data.forEach(item => {
                // Create a block for each item
                const block = document.createElement('div');
                block.classList.add('data-block'); // Add a class for styling
                block.classList.add('clickable'); // Add a class for making it clickable

                // Construct the HTML content based on each item
                block.innerHTML = `
                    <p><strong>Data Date:</strong> ${item.DATA_DATE}</p>
                    <p><strong>Time Create:</strong> ${item.TIME_CREATE}</p>
                    <p><strong>Meter ID:</strong> ${item.METER_ID}</p>
                    <p><strong>Run:</strong> ${item.RUN}</p>
                    <p><strong>Corrected Volume:</strong> ${item.CORRECTED_VOL}</p>
                    <p><strong>Uncorrected Volume:</strong> ${item.UNCORRECTED_VOL}</p>
                    <p><strong>Average PF:</strong> ${item.AVR_PF}</p>
                    <p><strong>Average TF:</strong> ${item.AVR_TF}</p>
                    

                `;

                // Add a click event listener to each block
                block.addEventListener('click', () => {
                    // Ask for confirmation before proceeding
                    if (confirm(`Are you sure you want to select this data?`)) {
                        // Handle selection here
                        console.log('Data selected:', item);
                        // Send selected data back to Flask
                        sendSelectedData(item);
                    }
                });

                // Append the block to horizontalContainer
                horizontalContainer.appendChild(block);
            });

            // Append horizontalContainer to popupMessage
            popupMessage.appendChild(horizontalContainer);
        }

        // Show the popup
        const popupOverlay = document.getElementById('popup-overlay');
        const popup = document.getElementById('popup');
        popupOverlay.style.display = 'block';
        popup.style.display = 'block';
    })
    .catch(error => {
        console.error('Error:', error);
        // Handle fetch request error cases
        window.alert('Error fetching data. Please try again later.');
    });
}

function sendSelectedData(item) {
  fetch('/selected_data', {
      method: 'POST',
      headers: {
          'Content-Type': 'application/json'
      },
      body: JSON.stringify(item)
  })
  .then(response => response.json())
  .then(data => {
      if (data.status === 'success') {
          alert('Data sent successfully!');
          closePopup(); // Assuming closePopup is defined elsewhere
          // Reload or reset system state after success
          location.reload(); // Reloads the current page
          // Alternatively, reset any system state as needed
          // resetSystemState();
      } else {
          alert('Error: ' + data.message);
      }
  })
  .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while sending data.');
  });
}


function closePopup() {
    const popupOverlay = document.getElementById('popup-overlay');
    const popup = document.getElementById('popup');
    popupOverlay.style.display = 'none';
    popup.style.display = 'none';
}

  </script>


<script>
  function validateForm() {
      var region = document.getElementById("region_dropdown").value;
      var site = document.getElementById("tag_dropdown").value;
      var date = document.getElementById("date_picker").value;

      if (region === "" || site === "" || date === "") {
          alert("Please select all required fields.");
          return false;
      }

      // Additional validation logic can be added here if needed

      // If all validation passes, show loading overlay or proceed with form submission
      showLoading();
  }

  function clearFilters() {
      // Logic to clear selected filters
      document.getElementById("region_dropdown").value = "";
      document.getElementById("tag_dropdown").value = "";
      document.getElementById("date_picker").value = "";
  }

  function showLoading() {
      // Logic to show loading overlay
      document.getElementById("loadingOverlay").style.display = "block";
  }

  function checkDate() {
      // Optional: Date validation logic
  }
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    hideLoader();
  });

  function showLoader() {
    var loaderContainer = document.getElementById("loadingOverlay");
    loaderContainer.style.display = "flex"; // แสดง Loader

    var progressBar = document.getElementById("progressBar");
    progressBar.style.width = "0%"; // เริ่มต้นที่ความคืบหน้า 0%
  }

  function hideLoader() {
    var loaderContainer = document.getElementById("loadingOverlay");
    loaderContainer.style.display = "none"; // ซ่อน Loader
  }

  // เรียกใช้ showLoader เมื่อต้องการแสดง Loader (เช่น เมื่อมีการโหลดข้อมูล)
  // เรียกใช้ hideLoader เมื่อต้องการซ่อน Loader (เมื่อข้อมูลโหลดเสร็จ)

  // ฟังก์ชันนี้ให้ความคืบหน้า (progress) สามารถเรียกใช้ได้ตามต้องการ
  function setProgress(percentage) {
    var progressBar = document.getElementById("progressBar");
    progressBar.style.width = percentage + "%";
  }

  // ตัวอย่างการเรียกใช้ setProgress เมื่อต้องการเพิ่มความคืบหน้า
  // setProgress(50); // เพิ่มความคืบหน้าที่ 50%

</script>
<script>
  //  <div id="loading-bar-container">
  //     <div id="loading-bar"></div>
  // </div>
  // Function to show the loading bar
  function showLoadingBar() {
    document.getElementById('loading-bar').style.width = '100%';
  }

  // Function to hide the loading bar
  function hideLoadingBar() {
    document.getElementById('loading-bar').style.width = '0';
  }

  // Event listener for page load
  window.addEventListener('load', function () {
    hideLoadingBar(); // Hide the loading bar initially
  });

  // Event listener for beforeunload (when the page is about to be reloaded)
  window.addEventListener('beforeunload', function () {
    showLoadingBar(); // Show the loading bar before the page reloads
  });

</script>
<script>

  function clearFilters() {
    document.getElementById('region_dropdown').value = '';
    document.getElementById('tag_dropdown').value = '';
    document.getElementById('date_picker').value = '';
    function showLoading() {
      document.getElementById('loadingOverlay').style.display = 'block';
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    // Assuming you have JavaScript/jQuery to handle changes and update the display
    var selectedRegion = null;
    var selectedTag = null;
    var selectedDate = null;

    document.getElementById('region_dropdown').addEventListener('change', function () {
      selectedRegion = this.value;
    });

    document.getElementById('tag_dropdown').addEventListener('change', function () {
      selectedTag = this.value;
    });

    document.getElementById('date_picker').addEventListener('change', function () {
      selectedDate = this.value;
    });

    // Event listener for form submission with 'daily_data' event
    var formDailyData = document.querySelector('form[action="/billing_data"]'); // Adjust this selector based on your actual form
    formDailyData.addEventListener('config_data', function (event) {
      event.preventDefault(); // Prevent the form from submitting immediately

      showLoadingOverlay();

      // Simulate delay with setTimeout (you can replace this with your actual loading logic)
      setTimeout(function () {
        // Update the displayed values after the loading is complete
        document.getElementById('selected_region').innerText = selectedRegion;
        document.getElementById('selected_tag').innerText = selectedTag;
        document.getElementById('selected_date').innerText = selectedDate;

        // Optionally, update the meter ID
        var selectedMeterIdSpan = document.getElementById('selected_meter_id');
        if (selectedMeterIdSpan) {
          selectedMeterIdSpan.innerText = "{{ selected_meter_id }}"; // Replace with your actual meter ID variable
        }

        // Reset selected values
        selectedRegion = null;
        selectedTag = null;
        selectedDate = null;

        // Submit the form programmatically
        formDailyData.submit();
      }, 2000); // Adjust the delay time as needed (in milliseconds)
    });

    // Event listener for form submission with 'config_data' event
    var formConfigData = document.querySelector('form[action="/billing_data"]'); // Adjust this selector based on your actual form
    formConfigData.addEventListener('daily_data', function (event) {
      event.preventDefault(); // Prevent the form from submitting immediately

      showLoadingOverlay();

      // Simulate delay with setTimeout (you can replace this with your actual loading logic)
      setTimeout(function () {
        // Update the displayed values after the loading is complete
        document.getElementById('selected_region').innerText = selectedRegion;
        document.getElementById('selected_tag').innerText = selectedTag;
        document.getElementById('selected_date').innerText = selectedDate;

        // Optionally, update the meter ID
        var selectedMeterIdSpan = document.getElementById('selected_meter_id');
        if (selectedMeterIdSpan) {
          selectedMeterIdSpan.innerText = "{{ selected_meter_id }}"; // Replace with your actual meter ID variable
        }

        // Reset selected values
        selectedRegion = null;
        selectedTag = null;
        selectedDate = null;

        // Submit the form programmatically
        formConfigData.submit();
      }, 2000); // Adjust the delay time as needed (in milliseconds)
    });
  });
  function showLoading() {
    // แสดง loading overlay
    document.getElementById('loadingOverlay').style.display = 'block';
  }

  // ฟังก์ชันนี้ควรถูกเรียกเมื่อข้อมูลถูกโหลดแล้ว
  function hideLoading() {
    // ซ่อน loading overlay
    document.getElementById('loadingOverlay').style.display = 'none';
  }


  // Wait for the document to be ready
  // Wait for the document to be ready

    // Event listener for region dropdown change
    $('#region_dropdown').change(function () {
      var selectedRegion = $(this).val();

      $.ajax({
        type: 'GET',
        url: '/get_tags',
        data: { 'selected_region': selectedRegion },
        success: function (response) {
          // Clear existing options in the tag dropdown
          $('#tag_dropdown').empty();

          // Add the 'All' option
          $('#tag_dropdown').append('<option value="" selected>All</option>');

          // Add new tag options based on the response
          for (var i = 0; i < response.tag_options.length; i++) {
            var tag = response.tag_options[i];

            // Check if the tag is the first one in the list, and set it as selected
            var isSelected = i === 0 ? 'selected' : '';

            $('#tag_dropdown').append('<option value="' + tag + '" ' + isSelected + '>' + tag + '</option>');
          }
          hideLoadingOverlay(); // Hide loading overlay after successful AJAX request
        },
        error: function (error) {
          console.log('Error fetching tag options:', error);
          hideLoadingOverlay(); // Hide loading overlay after AJAX request error
        }
      });
    });


</script>
<script>
  function showDatePicker() {
    var dateMode = $('input[name="date_mode"]:checked').val();
    if (dateMode === 'date') {
        $('#date_picker').datepicker('destroy').datepicker({
            format: 'dd/mm/yyyy',
            startView: 'days',
            minViewMode: 'days',
            autoclose: true,
        }).datepicker('show');
    } else if (dateMode === 'month') {
        $('#date_picker').datepicker('destroy').datepicker({
            format: 'mm/yyyy',
            startView: 'months',
            minViewMode: 'months',
            autoclose: true,
        }).datepicker('show');
    }
}

$(document).ready(function () {
    showDatePicker();  // Initialize the date picker based on the default selection
});

</script>
<script>
  function checkInternetConnection() {
    // ตรวจสอบสถานะเชื่อมต่ออินเทอร์เน็ต
    // ตรวจสอบได้ว่ามีการเชื่อมต่อหรือไม่ โดยใช้ navigator.onLine
    return navigator.onLine;
  }

  // JavaScript
  function updateStatus() {
    var statusContainer = document.getElementById('status-container');
    var statusIcon = document.getElementById('status-icon');
    var statusText = document.getElementById('status-text');
    var lastUpdate = document.getElementById('last-update-time');

    var now = new Date();
    var timeString = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true });

    if (checkInternetConnection()) {
      // ถ้าเชื่อมต่ออินเทอร์เน็ต
      statusIcon.style.color = 'green'; // สีเขียว
      statusText.textContent = 'Online';
      statusText.classList.remove('offline'); // ลบ class 'offline' ถ้ามี
    } else {
      // ถ้าไม่เชื่อมต่ออินเทอร์เน็ต
      statusIcon.style.color = 'red'; // สีแดง
      statusText.textContent = 'Offline';
      statusText.classList.add('offline'); // เพิ่ม class 'offline'
    }

    lastUpdate.textContent = timeString;
  }
  // JavaScript
  setInterval(updateStatus, 10000); // อัปเดตทุก 1 วินาที (1000 มิลลิวินาที)

</script>
<script>
  // Function to update weather icon
  function updateWeatherIcon(weatherCondition) {
    var iconClass;

    // Add logic to determine the appropriate weather icon based on the condition
    switch (weatherCondition.toLowerCase()) {
      case 'clear':
        iconClass = 'fas fa-sun'; // Font Awesome sun icon
        break;
      case 'clouds':
        iconClass = 'fas fa-cloud'; // Font Awesome cloud icon
        break;
      case 'rain':
        iconClass = 'fas fa-cloud-showers-heavy'; // Font Awesome rain icon
        break;
      case 'thunderstorm':
        iconClass = 'fas fa-bolt'; // Font Awesome thunderstorm icon
        break;
      case 'snow':
        iconClass = 'fas fa-snowflake'; // Font Awesome snow icon
        break;
      default:
        iconClass = 'fas fa-question-circle'; // Default to a question mark icon for unknown conditions
    }

    // Set the appropriate icon class
    document.getElementById('weather-icon').innerHTML = '<i class="' + iconClass + '"></i>';
  }

</script>
<script>
  // Function to update date and time
  function updateDateTime() {
    var now = new Date();
    var dateTimeString = now.toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: false });
    document.getElementById('date-time').textContent = dateTimeString;
  }

  // Function to update weather data from OpenWeatherMap API
  function updateWeatherData() {
    // Replace 'YOUR_API_KEY' with your actual OpenWeatherMap API key
    var apiKey = 'fbae867d03fc9892a7469d2f562ce558';
    var city = 'Bangkok'; // Replace with your city name
    var apiUrl = 'https://api.openweathermap.org/data/2.5/weather?q=' + city + '&appid=' + apiKey;

    fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        // Extract relevant weather data
        var weatherCondition = data.weather[0].main;
        var weatherDescription = data.weather[0].description;
        var temperatureKelvin = data.main.temp;

        // Convert temperature from Kelvin to Celsius
        var temperatureCelsius = temperatureKelvin - 273.15;

        // Update weather icon, description, and temperature
        updateWeatherIcon(weatherCondition);
        document.getElementById('weather-description').textContent = 'Weather: ' + weatherDescription;
        document.getElementById('temperature').textContent = 'Temperature: ' + temperatureCelsius.toFixed(2) + '°C';
      })
      .catch(error => console.error('Error fetching weather data:', error));
  }


  // Function to update weather icon
  function updateWeatherIcon(weatherCondition) {
    var iconClass;

    // Add logic to determine the appropriate weather icon based on the condition
    switch (weatherCondition.toLowerCase()) {
      case 'clear':
        iconClass = 'fa-sun';
        break;
      case 'clouds':
        iconClass = 'fa-cloud';
        break;
      case 'rain':
        iconClass = 'fa-cloud-showers-heavy';
        break;
      default:
        iconClass = 'fa-question-circle'; // Default to a question mark icon for unknown conditions
    }

    // Set the appropriate icon class
    document.getElementById('weather-icon').innerHTML = '<i class="fa ' + iconClass + '" aria-hidden="true"></i>';
  }

  // Call the functions initially
  updateDateTime();
  updateWeatherData();

  // Update date and time every second
  setInterval(updateDateTime, 1000);

  // Update weather data every 10 minutes (adjust as needed)
  setInterval(updateWeatherData, 600000);
</script>
<script>
  $(".sidebar-dropdown > a").click(function () {
    $(".sidebar-submenu").slideUp(200);
    if (
      $(this)
        .parent()
        .hasClass("active")
    ) {
      $(".sidebar-dropdown").removeClass("active");
      $(this)
        .parent()
        .removeClass("active");
    } else {
      $(".sidebar-dropdown").removeClass("active");
      $(this)
        .next(".sidebar-submenu")
        .slideDown(200);
      $(this)
        .parent()
        .addClass("active");
    }
  });

  $("#close-sidebar").click(function () {
    $(".page-wrapper").removeClass("toggled");
  });
  $("#show-sidebar").click(function () {
    $(".page-wrapper").addClass("toggled");
  });


</script>

<script src="{{ url_for('static', filename='js/sb-admin-2.min.js') }}"></script>