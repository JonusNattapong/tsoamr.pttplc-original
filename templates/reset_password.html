<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รีเซ็ตรหัสผ่าน</title>
     <!-- Stylesheet
    <link rel="stylesheet" href="/HOME (Doing Here)/templates/Css/home.css"> -->
        
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Bootstrap Scripts -->
   
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Bootstrap Datepicker Stylesheet and Script -->
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/css/bootstrap-datepicker.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/sb-admin-2.css') }}">
    
    
</head>
<body class="bg-gradient-primary1">

    <div class="container">

        <!-- Outer Row -->
        <div class="row justify-content-center" style="align-items: center;">

            <div class="col-xl-10 col-lg-12 col-md-9" >

                <div class="card o-hidden border-0 shadow-lg my-5" >
                    <div class="card-body " style="text-align: center;">
                       
                       
                <h1>Reset password for {{ username }}</h1>
                <br>
                <form method="POST" onsubmit="return validateForm();" >
                    <div class="form-group" >
                        <label for="password">New Password:</label>
                        <div class="password-container "  >
                    <input type="password" id="new_password" name="new_password"  class="form-control bg-light  small" placeholder="New Password" style="border-radius: 5px;" required>
                    <i id="toggleNewPassword" class="eye-icon fas fa-eye"></i>
                </div>
                    <div id="passwordMessage" class="validation-message"></div>
                </div>
                    <div class="form-group">
                        <label for="confirmpassword">Confirm Password:</label>
                        <div class="password-container">
                    <input type="password" id="confirm_password" name="confirm_password" class="form-control bg-light  small" placeholder="Confirm Password" style="border-radius: 5px;"  required>
                    <i id="toggleConfirmPassword" class="eye-icon fa fa-eye"></i>
                </div>
                    <div id="confirmPasswordMessage" class="validation-message"></div>
                </div>
                    <br>
                    <button type="submit" class="btn btn-success btn-icon-split mx-2" id="submitButton" disabled><span class="text">Reset Password</span></button>
                </form>
            </div>
</div>
</div>
</div>
</div>
    <script>
        // Function to handle visibility toggle for a password field
        function setupPasswordVisibilityToggle(inputId, iconId) {
            var passwordInput = document.getElementById(inputId);
            var eyeIcon = document.getElementById(iconId);
    
            // Ensure the icon and input are correctly selected
            if (!passwordInput || !eyeIcon) {
                console.error(`Element with ID ${inputId} or ${iconId} not found.`);
                return;
            }
    
            // Toggle password visibility
            eyeIcon.addEventListener('click', function() {
                var type = passwordInput.type === 'password' ? 'text' : 'password';
                passwordInput.type = type;
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
    
            // Show or hide the eye icon based on input content
            passwordInput.addEventListener('input', function() {
                eyeIcon.style.display = this.value.length > 0 ? 'block' : 'none';
            });
        }
    
        // Function to validate password based on length, letter, and number criteria
        function validatePassword(password) {
            var lengthCriteria = password.length >= 8 && password.length <= 12;
            var letterUpperCriteria = /[A-Z]/.test(password);
            var letterLowerCriteria = /[a-z]/.test(password);
            var numberCriteria = /[0-9]/.test(password);
            var specialCharCriteria = /[!@#$%^&*()_+{}\[\]:;"'<>,.?~`]/.test(password);
            var message = '';

            if (!lengthCriteria) message += '8-12 characters required. ';
            if (!letterUpperCriteria) message += 'Include at least one uppercase letter. ';
            if (!letterLowerCriteria) message += 'Include at least one lowercase letter. ';
            if (!numberCriteria) message += 'Include at least one number. ';
            if (!specialCharCriteria) message += 'Include at least one special character. ';

            return {
                valid: lengthCriteria && letterUpperCriteria && letterLowerCriteria && numberCriteria && specialCharCriteria,
                message: message.trim()
            };
        }
    
        // Function to validate the entire form
        function validateForm() {
            var newPassword = document.getElementById('new_password').value;
            var confirmPassword = document.getElementById('confirm_password').value;
            var validationResult = validatePassword(newPassword);
    
            // Check if passwords match and new password is valid
            if (validationResult.valid && newPassword === confirmPassword) {
                return true;
            } else {
                if (!validationResult.valid) {
                    alert(validationResult.message);
                } else {
                    alert('รหัสผ่านไม่ตรงกัน');
                }
                return false;
            }
        }
    
        // Update submit button state based on validation
        function updateSubmitButtonState() {
            var newPassword = document.getElementById('new_password').value;
            var confirmPassword = document.getElementById('confirm_password').value;
            var submitButton = document.getElementById('submitButton');
            var validationResult = validatePassword(newPassword);
    
            // Enable or disable the button based on conditions
            if (validationResult.valid && newPassword === confirmPassword) {
                submitButton.disabled = false;
            } else {
                submitButton.disabled = true;
            }
        }
    
        // Event listeners for input fields
        var newPasswordInput = document.getElementById('new_password');
        var confirmPasswordInput = document.getElementById('confirm_password');
    
        newPasswordInput.addEventListener('input', function() {
            var password = this.value;
            var validationResult = validatePassword(password);
            var messageElement = document.getElementById('passwordMessage');
    
            // Show password validation message
            if (validationResult.valid) {
                messageElement.textContent = 'The password is correct.';
                messageElement.classList.remove('validation-message');
                messageElement.classList.add('validation-message', 'valid');
            } else {
                messageElement.textContent = validationResult.message;
                messageElement.classList.remove('validation-message', 'valid');
                messageElement.classList.add('validation-message');
            }
    
            updateSubmitButtonState();
        });
    
        confirmPasswordInput.addEventListener('input', function() {
            var confirmPassword = this.value;
            var newPassword = newPasswordInput.value;
            var confirmPasswordMessage = document.getElementById('confirmPasswordMessage');
    
            // Show or hide the eye icon based on input content
            var confirmPasswordEyeIcon = document.getElementById('toggleConfirmPassword');
            confirmPasswordEyeIcon.style.display = this.value.length > 0 ? 'block' : 'none';
    
            // Check if passwords match
            if (confirmPassword === newPassword) {
                confirmPasswordMessage.textContent = 'Passwords match';
                confirmPasswordMessage.classList.remove('validation-message');
                confirmPasswordMessage.classList.add('validation-message', 'match');
            } else {
                confirmPasswordMessage.textContent = 'Passwords not match';
                confirmPasswordMessage.classList.remove('validation-message', 'match');
                confirmPasswordMessage.classList.add('validation-message');
            }
    
            updateSubmitButtonState();
        });
    
        // Set up visibility toggle for each password field
        setupPasswordVisibilityToggle('new_password', 'toggleNewPassword');
        setupPasswordVisibilityToggle('confirm_password', 'toggleConfirmPassword');
    </script>
</body>
</html>
